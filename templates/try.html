<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ultra Video Player</title>
<style>
  :root{
    --bg:#0f1720;
    --panel:#0b1220;
    --muted:#94a3b8;
    --accent:#56a3ff;
    --accent-2:#7ef6a3;
    --glass: rgba(255,255,255,0.04);
    --control-height:48px;
    --radius:12px;
    --gap:10px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:18px;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#071022 0%, #071421 100%);
    color:#e6eef8;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    gap:18px;
    padding:24px;
  }

  .player {
    width:100%;
    max-width:1100px;
    background: linear-gradient(180deg,var(--panel), rgba(10,14,20,0.7));
    border-radius:var(--radius);
    overflow:hidden;
    box-shadow: 0 10px 30px rgba(2,6,12,0.7), inset 0 1px 0 rgba(255,255,255,0.02);
    border:1px solid rgba(255,255,255,0.03);
  }

  .video-wrap{
    position:relative;
    background: #000;
    aspect-ratio: 16 / 9;
    max-height:70vh;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  video{
    width:100%;
    height:100%;
    object-fit:contain;
    background:#000;
    display:block;
  }

  /* overlay center big play when paused */
  .big-play{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;
    transition:opacity .18s ease;
  }
  .big-play button{
    pointer-events:auto;
    border: none;
    background:linear-gradient(180deg,var(--accent), #2b8de1);
    color:#002038;
    font-weight:700;
    padding:14px 18px;
    border-radius:999px;
    display:flex;
    gap:12px;
    align-items:center;
    box-shadow:0 6px 18px rgba(5,78,130,0.35);
    transform:translateY(0);
    cursor:pointer;
  }

  .controls{
    padding:12px;
    display:flex;
    flex-direction:column;
    gap:8px;
  }

  /* progress */
  .progress-wrap{
    width:100%;
    display:flex;
    align-items:center;
    gap:8px;
  }
  .time{font-size:12px;color:var(--muted);min-width:58px;text-align:center}

  .progress {
    -webkit-appearance: none;
    appearance:none;
    height:8px;
    background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
    border-radius:999px;
    width:100%;
    position:relative;
    outline:none;
    cursor:pointer;
  }
  .progress::-webkit-slider-thumb{
    -webkit-appearance:none;
    width:14px;height:14px;border-radius:50%;
    background:linear-gradient(180deg,var(--accent),#2b8de1);
    box-shadow:0 4px 10px rgba(43,141,225,0.35);
    border:2px solid rgba(255,255,255,0.08);
    margin-top:-3px;
  }

  /* controls row */
  .row{
    display:flex;
    align-items:center;
    gap:8px;
    justify-content:space-between;
  }

  .left, .center, .right { display:flex; align-items:center; gap:8px; }

  button.control{
    height:var(--control-height);
    min-width:42px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    padding:8px 12px;
    border-radius:8px;
    border:none;
    background:var(--glass);
    color:var(--muted);
    cursor:pointer;
    transition:all .12s ease;
  }
  button.control:hover{ transform:translateY(-2px); color:#fff; box-shadow:0 6px 20px rgba(0,0,0,0.45) }

  .icon { width:18px;height:18px; display:inline-block; }

  .volume{
    display:flex;
    align-items:center;
    gap:8px;
    padding:6px;
    border-radius:10px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
  }
  input[type=range].vol{
    width:110px;
    height:6px;
    -webkit-appearance:none;
    background:transparent;
  }
  input[type=range].vol::-webkit-slider-runnable-track{ height:6px;background:linear-gradient(90deg,var(--accent),var(--accent-2)); border-radius:999px; }
  input[type=range].vol::-webkit-slider-thumb{ -webkit-appearance:none;width:14px;height:14px;border-radius:50%; background:#fff;border:2px solid rgba(0,0,0,0.18); margin-top:-4px; }

  select.speed {
    background:transparent;
    border:1px solid rgba(255,255,255,0.04);
    color:var(--muted);
    padding:8px 10px;
    border-radius:8px;
    min-width:84px;
    height:var(--control-height);
  }

  .meta{
    font-size:13px;
    color:var(--muted);
  }

  /* small and responsive */
  @media (max-width:640px){
    .player{ border-radius:10px; }
    .time{display:none}
    input[type=range].vol{ width:70px }
    button.control{min-width:36px;padding:8px}
  }

  /* focus visible */
  .player :focus{ outline: 2px solid rgba(86,163,255,0.16); outline-offset:2px; }

  /* tooltip for keyboard hints */
  .hint{
    font-size:12px;color:var(--muted);
  }
</style>
</head>
<body>

<div class="player" id="player">
  <div class="video-wrap" id="videoWrap">
    <video id="video" preload="metadata" crossorigin="anonymous">
      <!-- Replace src with your video file(s). If you want multiple sources, add additional <source> tags -->
      <source src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>

    <!-- Big center play button -->
    <div class="big-play" id="bigPlay" aria-hidden="false">
      <button id="bigPlayBtn" title="Play (Space)">
        <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M5 3v18l15-9L5 3z" fill="#fff"/></svg>
        Play
      </button>
    </div>
  </div>

  <div class="controls" role="group" aria-label="Video controls">
    <!-- progress + time -->
    <div class="progress-wrap">
      <div class="time" id="current">0:00</div>
      <input type="range" id="progress" class="progress" min="0" max="100" value="0" step="0.1" aria-label="Seek">
      <div class="time" id="duration">0:00</div>
    </div>

    <!-- control row -->
    <div class="row">
      <div class="left">
        <button class="control" id="play" title="Play / Pause (Space)" aria-pressed="false">
          <svg id="playIcon" class="icon" viewBox="0 0 24 24" fill="none"><path d="M5 3v18l15-9L5 3z" fill="#fff"/></svg>
        </button>

        <div class="volume" title="Volume (Up/Down)">
          <button class="control" id="mute" title="Mute (M)" aria-pressed="false">
            <svg class="icon" viewBox="0 0 24 24" fill="none"><path id="volIcon" d="M5 9v6h4l5 4V5L9 9H5z" fill="#fff"/></svg>
          </button>
          <input type="range" id="volume" class="vol" min="0" max="1" step="0.01" value="1" aria-label="Volume">
        </div>

        <div class="meta hint" id="speedLabel">Speed</div>
        <select class="speed" id="speed" title="Playback speed">
          <option value="0.5">0.5x</option>
          <option value="1" selected>1x</option>
          <option value="1.25">1.25x</option>
          <option value="1.5">1.5x</option>
          <option value="2">2x</option>
        </select>

        <button class="control" id="pip" title="Picture-in-Picture (P)">
          PiP
        </button>

      </div>

      <div class="center">
        <div class="meta hint">Shortcuts: <span style="color:var(--accent)">Space</span> Play • <span style="color:var(--accent)">← →</span> Seek • <span style="color:var(--accent)">F</span> Fullscreen</div>
      </div>

      <div class="right">
        <button class="control" id="fullscreen" title="Fullscreen (F)">
          Full
        </button>
        <button class="control" id="download" title="Download video">
          Download
        </button>
      </div>
    </div>
  </div>
</div>

<script>
/* Ultra Video Player - Vanilla JS
   Features implemented:
   - Play/pause (button + big overlay + keyboard)
   - Progress bar + seek + clickable
   - Volume slider + mute toggle + keyboard volume
   - Fullscreen toggle (F)
   - Time current / total
   - Playback speed control (select)
   - Keyboard shortcuts: Space/K play, Left/Right seek, Up/Down volume, M mute, F fullscreen, P PiP, ,/. speed
   - Picture-in-Picture (P)
   - Download button: tries fetch->blob for reliable download; falls back to opening src
*/

(function(){
  const player = document.getElementById('player');
  const video = document.getElementById('video');
  const playBtn = document.getElementById('play');
  const playIcon = document.getElementById('playIcon');
  const bigPlay = document.getElementById('bigPlay');
  const bigPlayBtn = document.getElementById('bigPlayBtn');
  const progress = document.getElementById('progress');
  const currentEl = document.getElementById('current');
  const durationEl = document.getElementById('duration');
  const volume = document.getElementById('volume');
  const muteBtn = document.getElementById('mute');
  const volIconPath = document.getElementById('volIcon');
  const speedSel = document.getElementById('speed');
  const fullscreenBtn = document.getElementById('fullscreen');
  const pipBtn = document.getElementById('pip');
  const downloadBtn = document.getElementById('download');
  const videoWrap = document.getElementById('videoWrap');

  // Helpers
  function fmtTime(s){
    if(isNaN(s) || !isFinite(s)) return '0:00';
    s = Math.floor(s);
    const mm = Math.floor(s/60);
    const ss = (s % 60).toString().padStart(2,'0');
    return mm + ':' + ss;
  }

  // Update UI
  function updatePlayState(){
    if(video.paused){
      playBtn.setAttribute('aria-pressed','false');
      playIcon.innerHTML = '<path d="M5 3v18l15-9L5 3z" fill="#fff"/>';
      bigPlay.style.opacity = 1;
      bigPlay.style.pointerEvents = 'auto';
      bigPlay.setAttribute('aria-hidden','false');
    } else {
      playBtn.setAttribute('aria-pressed','true');
      playIcon.innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" fill="#fff"/>'; // pause icon
      bigPlay.style.opacity = 0;
      bigPlay.style.pointerEvents = 'none';
      bigPlay.setAttribute('aria-hidden','true');
    }
  }

  function updateProgress(){
    const pct = video.duration ? (video.currentTime / video.duration) * 100 : 0;
    progress.value = pct;
    currentEl.textContent = fmtTime(video.currentTime);
    durationEl.textContent = fmtTime(video.duration);
  }

  function setVolume(v){
    video.volume = v;
    volume.value = v;
    if(video.muted && v>0) video.muted = false;
    updateVolIcon();
  }

  function updateVolIcon(){
    if(video.muted || video.volume === 0){
      volIconPath.setAttribute('d','M16 7L12 11l4 4V7z M19 5v14'); // symbolic
      muteBtn.setAttribute('aria-pressed','true');
    } else if(video.volume < 0.5){
      volIconPath.setAttribute('d','M5 9v6h4l5 4V5L9 9H5z'); // medium
      muteBtn.setAttribute('aria-pressed','false');
    } else {
      volIconPath.setAttribute('d','M5 9v6h4l5 4V5L9 9H5z');
      muteBtn.setAttribute('aria-pressed','false');
    }
  }

  // Play / pause
  function togglePlay(){
    if(video.paused) {
      const p = video.play();
      if(p && p.catch){ p.catch(e => console.warn('Play prevented:', e)); }
    } else {
      video.pause();
    }
    updatePlayState();
  }

  playBtn.addEventListener('click', togglePlay);
  bigPlayBtn.addEventListener('click', togglePlay);
  video.addEventListener('play', updatePlayState);
  video.addEventListener('pause', updatePlayState);

  // Progress interactions
  video.addEventListener('timeupdate', updateProgress);
  video.addEventListener('loadedmetadata', updateProgress);
  video.addEventListener('durationchange', updateProgress);

  let userSeeking = false;
  progress.addEventListener('input', (e)=>{
    userSeeking = true;
    const pct = parseFloat(e.target.value);
    const t = video.duration * (pct/100 || 0);
    currentEl.textContent = fmtTime(t);
  });

  progress.addEventListener('change', (e)=>{
    const pct = parseFloat(e.target.value);
    const t = video.duration * (pct/100 || 0);
    video.currentTime = t;
    userSeeking = false;
  });

  // Click-to-seek on progress (improve UX)
  progress.addEventListener('click', (e)=>{
    const rect = e.target.getBoundingClientRect();
    const relative = (e.clientX - rect.left) / rect.width;
    video.currentTime = video.duration * relative;
  });

  // Volume
  volume.addEventListener('input', (e) => {
    setVolume(parseFloat(e.target.value));
  });

  muteBtn.addEventListener('click', ()=>{
    video.muted = !video.muted;
    if(!video.muted && video.volume === 0){
      setVolume(0.5);
    }
    updateVolIcon();
  });

  // Speed selector
  speedSel.addEventListener('change', (e)=>{
    video.playbackRate = parseFloat(e.target.value);
  });

  // Fullscreen
  async function toggleFullscreen(){
    if(!document.fullscreenElement){
      try {
        await player.requestFullscreen();
      } catch(e){ console.warn('Fullscreen failed', e) }
    } else {
      try { await document.exitFullscreen(); } catch(e){}
    }
  }
  fullscreenBtn.addEventListener('click', toggleFullscreen);

  // PiP
  pipBtn.addEventListener('click', async ()=>{
    if(!document.pictureInPictureElement){
      try {
        // video must be loaded
        if(document.fullscreenElement){
          await document.exitFullscreen();
        }
        await video.requestPictureInPicture();
      } catch(e){
        console.warn('PiP failed:', e);
      }
    } else {
      try {
        await document.exitPictureInPicture();
      } catch(e){}
    }
  });

  // Download: try fetch -> blob to ensure a "download" behavior
  downloadBtn.addEventListener('click', async ()=>{
    const src = (video.currentSrc || video.src);
    if(!src){
      alert('No video source found.');
      return;
    }
    // Try fetch->blob (CORS may block)
    try {
      downloadBtn.disabled = true;
      downloadBtn.textContent = 'Downloading...';
      const resp = await fetch(src, { mode: 'cors' });
      if(!resp.ok) throw new Error('Network response was not ok');

      const blob = await resp.blob();
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      // attempt to use filename from URL
      const filename = src.split('/').pop().split('?')[0] || 'video.mp4';
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    } catch(err){
      console.warn('Fetch download failed; falling back to opening source. Error:', err);
      // fallback: open in new tab (user can right-click to save)
      window.open(src, '_blank', 'noopener');
    } finally {
      downloadBtn.disabled = false;
      downloadBtn.textContent = 'Download';
    }
  });

  // Keyboard shortcuts (global while player is focused)
  let keysActive = true;
  // focus handling - capture keys when player or its children are focused
  player.addEventListener('keydown', (e)=>{
    // prevent interfering with form element interactions
    const tag = document.activeElement?.tagName?.toLowerCase();
    if(tag === 'input' || tag === 'textarea' || tag === 'select') return;

    switch(e.key.toLowerCase()){
      case ' ':
      case 'k':
        e.preventDefault();
        togglePlay();
        break;
      case 'm':
        video.muted = !video.muted;
        updateVolIcon();
        break;
      case 'f':
        e.preventDefault();
        toggleFullscreen();
        break;
      case 'p':
        // PiP
        e.preventDefault();
        pipBtn.click();
        break;
      case 'arrowleft':
        e.preventDefault();
        // seek back 5s (shift => 10s)
        video.currentTime = Math.max(0, video.currentTime - (e.shiftKey ? 10 : 5));
        break;
      case 'arrowright':
        e.preventDefault();
        video.currentTime = Math.min(video.duration || Infinity, video.currentTime + (e.shiftKey ? 10 : 5));
        break;
      case 'arrowup':
        e.preventDefault();
        setVolume(Math.min(1, video.volume + 0.05));
        break;
      case 'arrowdown':
        e.preventDefault();
        setVolume(Math.max(0, video.volume - 0.05));
        break;
      case ',':
        // slower
        e.preventDefault();
        changeSpeed(-1);
        break;
      case '.':
        // faster
        e.preventDefault();
        changeSpeed(1);
        break;
    }
  });

  // helper for speed cycling using the provided options
  function changeSpeed(dir){
    const opts = Array.from(speedSel.options).map(o => parseFloat(o.value));
    const cur = video.playbackRate || 1;
    let idx = opts.findIndex(v => v === cur);
    if(idx === -1){
      // fallback: find nearest
      idx = opts.reduce((best,i,ii)=> Math.abs